<head>
 
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io(location.host);
  socket.on('initialize', function (data) {
    var wishes = document.getElementById('wishes');
    console.log(data);
    data.wishes.forEach(function(x) {
      var li = document.createElement('li');
      li.innerHTML = x.wish + '(' + new Date(x.date * 1000) + ')';
      wishes.appendChild(li);
    });
  });
  
  socket.on('shootStar', function (data) {
    var star = document.getElementById('star');
    star.style.display = '';
    setTimeout(function () {
      star.style.display = 'none';
    }, data.expire);
    console.log(data);
  });
  
  socket.on('result', function (data) {
    console.log('result:' + data);
  });
  
  socket.on('showWish', function(data) {
    console.log('showWish:' + data.wish + ' ' + data.date);
    var li = document.createElement('li');
    li.innerHTML = data.wish + ' x:' + data.x + ' y:' + data.y;
    document.getElementById('newWishes').appendChild(li);
  });
  
  socket.on('currentWatcher', function(data) {
    document.getElementById('current').innerHTML = data;
  });
  
  function sendWish() {
    var wish = document.getElementById('wish').value;
    socket.emit('wish', { wish : wish });
  }
</script>
</head>
<body>
  <h2><span id='current'></span></h2>
  <div>
    <div id="star" style="display:none"><h1>shooting star now!</h1></div>
    <textarea id="wish"></textarea>
    <button onclick="sendWish();" >wish!</button>
  </div>
  <h3>wishes</h3>
  <ul id='newWishes'></ul>
  <ul id='wishes'>
    
  </ul>
</body>